/*
 * Copyright (C) 2022 The Android Open Source Project
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.example.adservices.samples.topics.sampleapp

import android.adservices.exceptions.GetTopicsException
import android.adservices.topics.GetTopicsRequest
import android.adservices.topics.GetTopicsResponse
import android.adservices.topics.TopicsManager
import android.annotation.SuppressLint
import android.os.Bundle
import android.os.OutcomeReceiver
import android.util.Log
import android.view.View
import android.widget.TextView
import androidx.appcompat.app.AppCompatActivity
import java.util.concurrent.Executor
import java.util.concurrent.Executors

@SuppressLint("NewApi")

/**
 * Android application activity for testing Topics API by sending a call to
 * the 'getTopics()' function onResume. When a result is received it will be displayed
 * on screen in a text box, as well as displaying a text box showing what the current
 * package name is for the application. This project can be build with 11 different
 * flavors, each of which will assign a different package name corresponding to a
 * different suite of possible Topics.
 */
class MainActivity : AppCompatActivity() {
  //TextView to display results from getTopics call
  private lateinit var results: TextView;

  //TextView to display current package name which influences returned topics
  private lateinit var packageNameDisplay: TextView;

  //On app creation setup view as well as assign variables for TextViews to display results
  override fun onCreate(savedInstanceState: Bundle?) {
    super.onCreate(savedInstanceState)
    setContentView(R.layout.activity_main)
    results = findViewById<View>(R.id.textView) as TextView
    packageNameDisplay = findViewById<View>(R.id.textView2) as TextView
  }

  //On Application Resume, call getTopics code. This can be used to facilitate automating population of topics data
  override fun onResume() {
    super.onResume()
    packageNameDisplay.text = baseContext.packageName
    TopicGetter()
  }

  //TopicGetter holds all of the setup and code for creating a TopicsManager and getTopics call
  fun TopicGetter() {
    val mContext = baseContext
    val mTopicsManager = mContext.getSystemService(
      TopicsManager::class.java)
    val mExecutor: Executor = Executors.newCachedThreadPool()
    val mGetTopicsRequest = GetTopicsRequest.Builder(mContext).setSdkName("com.example.adtech")
    mTopicsManager.getTopics(mGetTopicsRequest.build(), mExecutor,
                             mCallback as OutcomeReceiver<GetTopicsResponse, Exception>)
  }

  //onResult is called when getTopics successfully comes back with an answer
  var mCallback: OutcomeReceiver<*, *> =
    object : OutcomeReceiver<GetTopicsResponse, GetTopicsException> {
      override fun onResult(result: GetTopicsResponse) {
        val topicsResult = result.topics;
        for (i in topicsResult.indices) {
          Log.i("Topic", mTaxonomy[topicsResult[i].topicId])
          if (results.isEnabled) {
            results.text = mTaxonomy[topicsResult[i].topicId]
          }
        }
        if (topicsResult.size == 0) {
          Log.i("Topic", "Returned Empty")
          if (results.isEnabled) {
            results.text = "Returned Empty"
          }
        }
      }

      //onError should not be returned, even invalid topics callers should simply return empty
      override fun onError(error: GetTopicsException) {
        // Handle error
        Log.i("Topic", "Experienced an Error, and did not return successfully")
        if (results.isEnabled) {
          results.text = "Returned An Error"
        }
      }
    }

  //Local version of the Taxonomy as an array to make returned Topics clear
    val mTaxonomy= arrayOf(
    "/Arts & Entertainment",
    "/Arts & Entertainment/Acting & Theater",
    "/Arts & Entertainment/Comics",
    "/Arts & Entertainment/Concerts & Music Festivals",
    "/Arts & Entertainment/Dance",
    "/Arts & Entertainment/Entertainment Industry",
    "/Arts & Entertainment/Humor",
    "/Arts & Entertainment/Humor/Live Comedy",
    "/Arts & Entertainment/Live Sporting Events",
    "/Arts & Entertainment/Magic",
    "/Arts & Entertainment/Movie Listings & Theater Showtimes",
    "/Arts & Entertainment/Movies",
    "/Arts & Entertainment/Movies/Action & Adventure Films",
    "/Arts & Entertainment/Movies/Animated Films",
    "/Arts & Entertainment/Movies/Comedy Films",
    "/Arts & Entertainment/Movies/Cult & Indie Films",
    "/Arts & Entertainment/Movies/Documentary Films",
    "/Arts & Entertainment/Movies/Drama Films",
    "/Arts & Entertainment/Movies/Family Films",
    "/Arts & Entertainment/Movies/Horror Films",
    "/Arts & Entertainment/Movies/Romance Films",
    "/Arts & Entertainment/Movies/Thriller, Crime & Mystery Films",
    "/Arts & Entertainment/Music & Audio",
    "/Arts & Entertainment/Music & Audio/Blues",
    "/Arts & Entertainment/Music & Audio/Classical Music",
    "/Arts & Entertainment/Music & Audio/Country Music",
    "/Arts & Entertainment/Music & Audio/Dance & Electronic Music",
    "/Arts & Entertainment/Music & Audio/Folk & Traditional Music",
    "/Arts & Entertainment/Music & Audio/Jazz",
    "/Arts & Entertainment/Music & Audio/Musical Instruments",
    "/Arts & Entertainment/Music & Audio/Pop Music",
    "/Arts & Entertainment/Music & Audio/Rap & Hip-Hop",
    "/Arts & Entertainment/Music & Audio/Rock Music",
    "/Arts & Entertainment/Music & Audio/Rock Music/Classic Rock & Oldies",
    "/Arts & Entertainment/Music & Audio/Rock Music/Hard Rock & Progressive",
    "/Arts & Entertainment/Music & Audio/Rock Music/Indie & Alternative Music",
    "/Arts & Entertainment/Music & Audio/Soul & R&B",
    "/Arts & Entertainment/Music & Audio/Soundtracks",
    "/Arts & Entertainment/Music & Audio/Talk Radio",
    "/Arts & Entertainment/Music & Audio/World Music",
    "/Arts & Entertainment/Music & Audio/World Music/Reggae & Caribbean Music",
    "/Arts & Entertainment/Online Image Galleries",
    "/Arts & Entertainment/Online Video",
    "/Arts & Entertainment/Opera",
    "/Arts & Entertainment/TV Shows & Programs",
    "/Arts & Entertainment/TV Shows & Programs/TV Comedies",
    "/Arts & Entertainment/TV Shows & Programs/TV Documentary & Nonfiction",
    "/Arts & Entertainment/TV Shows & Programs/TV Dramas",
    "/Arts & Entertainment/TV Shows & Programs/TV Dramas/TV Soap Operas",
    "/Arts & Entertainment/TV Shows & Programs/TV Family-Oriented Shows",
    "/Arts & Entertainment/TV Shows & Programs/TV Reality Shows",
    "/Arts & Entertainment/TV Shows & Programs/TV Sci-Fi & Fantasy Shows",
    "/Arts & Entertainment/Visual Art & Design",
    "/Arts & Entertainment/Visual Art & Design/Design",
    "/Arts & Entertainment/Visual Art & Design/Painting",
    "/Arts & Entertainment/Visual Art & Design/Photographic & Digital Arts",
    "/Autos & Vehicles",
    "/Autos & Vehicles/Cargo Trucks & Trailers",
    "/Autos & Vehicles/Classic Vehicles",
    "/Autos & Vehicles/Custom & Performance Vehicles",
    "/Autos & Vehicles/Gas Prices & Vehicle Fueling",
    "/Autos & Vehicles/Motor Vehicles (By Type)",
    "/Autos & Vehicles/Motor Vehicles (By Type)/Autonomous Vehicles",
    "/Autos & Vehicles/Motor Vehicles (By Type)/Convertibles",
    "/Autos & Vehicles/Motor Vehicles (By Type)/Coupes",
    "/Autos & Vehicles/Motor Vehicles (By Type)/Hatchbacks",
    "/Autos & Vehicles/Motor Vehicles (By Type)/Hybrid & Alternative Vehicles",
    "/Autos & Vehicles/Motor Vehicles (By Type)/Luxury Vehicles",
    "/Autos & Vehicles/Motor Vehicles (By Type)/Microcars & Subcompacts",
    "/Autos & Vehicles/Motor Vehicles (By Type)/Motorcycles",
    "/Autos & Vehicles/Motor Vehicles (By Type)/Off-Road Vehicles",
    "/Autos & Vehicles/Motor Vehicles (By Type)/Pickup Trucks",
    "/Autos & Vehicles/Motor Vehicles (By Type)/Scooters & Mopeds",
    "/Autos & Vehicles/Motor Vehicles (By Type)/Sedans",
    "/Autos & Vehicles/Motor Vehicles (By Type)/Station Wagons",
    "/Autos & Vehicles/Motor Vehicles (By Type)/SUVs & Crossovers",
    "/Autos & Vehicles/Motor Vehicles (By Type)/SUVs & Crossovers/Crossovers",
    "/Autos & Vehicles/Motor Vehicles (By Type)/Vans & Minivans",
    "/Autos & Vehicles/Towing & Roadside Assistance",
    "/Autos & Vehicles/Vehicle & Traffic Safety",
    "/Autos & Vehicles/Vehicle Parts & Accessories",
    "/Autos & Vehicles/Vehicle Repair & Maintenance",
    "/Autos & Vehicles/Vehicle Shopping",
    "/Autos & Vehicles/Vehicle Shopping/Used Vehicles",
    "/Autos & Vehicles/Vehicle Shows",
    "/Beauty & Fitness",
    "/Beauty & Fitness/Body Art",
    "/Beauty & Fitness/Face & Body Care",
    "/Beauty & Fitness/Face & Body Care/Antiperspirants, Deodorants & Body Sprays",
    "/Beauty & Fitness/Face & Body Care/Bath & Body Products",
    "/Beauty & Fitness/Face & Body Care/Clean Beauty",
    "/Beauty & Fitness/Face & Body Care/Make-Up & Cosmetics",
    "/Beauty & Fitness/Face & Body Care/Nail Care Products",
    "/Beauty & Fitness/Face & Body Care/Perfumes & Fragrances",
    "/Beauty & Fitness/Face & Body Care/Razors & Shavers",
    "/Beauty & Fitness/Fashion & Style",
    "/Beauty & Fitness/Fitness",
    "/Beauty & Fitness/Fitness/Bodybuilding",
    "/Beauty & Fitness/Hair Care",
    "/Books & Literature",
    "/Books & Literature/Children's Literature",
    "/Books & Literature/Poetry",
    "/Business & Industrial",
    "/Business & Industrial/Advertising & Marketing",
    "/Business & Industrial/Advertising & Marketing/Sales",
    "/Business & Industrial/Agriculture & Forestry",
    "/Business & Industrial/Agriculture & Forestry/Food Production",
    "/Business & Industrial/Automotive Industry",
    "/Business & Industrial/Aviation Industry",
    "/Business & Industrial/Business Operations",
    "/Business & Industrial/Business Operations/Flexible Work Arrangements",
    "/Business & Industrial/Business Operations/Human Resources",
    "/Business & Industrial/Commercial Lending",
    "/Business & Industrial/Construction & Maintenance",
    "/Business & Industrial/Construction & Maintenance/Civil Engineering",
    "/Business & Industrial/Defense Industry",
    "/Business & Industrial/Energy & Utilities",
    "/Business & Industrial/Energy & Utilities/Water Supply & Treatment",
    "/Business & Industrial/Hospitality Industry",
    "/Business & Industrial/Manufacturing",
    "/Business & Industrial/Metals & Mining",
    "/Business & Industrial/Pharmaceuticals & Biotech",
    "/Business & Industrial/Printing & Publishing",
    "/Business & Industrial/Retail Trade",
    "/Business & Industrial/Venture Capital",
    "/Computers & Electronics",
    "/Computers & Electronics/Antivirus & Malware",
    "/Computers & Electronics/Computer Peripherals",
    "/Computers & Electronics/Consumer Electronics",
    "/Computers & Electronics/Consumer Electronics/Cameras & Camcorders",
    "/Computers & Electronics/Consumer Electronics/Home Automation",
    "/Computers & Electronics/Consumer Electronics/Home Theater Systems",
    "/Computers & Electronics/Consumer Electronics/Wearable Technology",
    "/Computers & Electronics/Desktop Computers",
    "/Computers & Electronics/Laptops & Notebooks",
    "/Computers & Electronics/Network Security",
    "/Computers & Electronics/Networking",
    "/Computers & Electronics/Networking/Distributed & Cloud Computing",
    "/Computers & Electronics/Programming",
    "/Computers & Electronics/Software",
    "/Computers & Electronics/Software/Audio & Music Software",
    "/Computers & Electronics/Software/Desktop Publishing",
    "/Computers & Electronics/Software/Freeware & Shareware",
    "/Computers & Electronics/Software/Graphics & Animation Software",
    "/Computers & Electronics/Software/Operating Systems",
    "/Computers & Electronics/Software/Photo Software",
    "/Computers & Electronics/Software/Video Software",
    "/Computers & Electronics/Software/Web Browsers",
    "/Finance",
    "/Finance/Accounting & Auditing",
    "/Finance/Accounting & Auditing/Tax Preparation & Planning",
    "/Finance/Credit Cards",
    "/Finance/Financial Planning & Management",
    "/Finance/Financial Planning & Management/Retirement & Pension",
    "/Finance/Grants, Scholarships & Financial Aid",
    "/Finance/Grants, Scholarships & Financial Aid/Study Grants & Scholarships",
    "/Finance/Home Financing",
    "/Finance/Insurance",
    "/Finance/Insurance/Auto Insurance",
    "/Finance/Insurance/Health Insurance",
    "/Finance/Insurance/Home Insurance",
    "/Finance/Insurance/Life Insurance",
    "/Finance/Insurance/Travel Insurance",
    "/Finance/Investing",
    "/Finance/Investing/Commodities & Futures Trading",
    "/Finance/Investing/Currencies & Foreign Exchange",
    "/Finance/Investing/Hedge Funds",
    "/Finance/Investing/Mutual Funds",
    "/Finance/Investing/Stocks & Bonds",
    "/Finance/Personal Loans",
    "/Finance/Student Loans & College Financing",
    "/Food & Drink",
    "/Food & Drink/Cooking & Recipes",
    "/Food & Drink/Cooking & Recipes/BBQ & Grilling",
    "/Food & Drink/Cooking & Recipes/Cuisines",
    "/Food & Drink/Cooking & Recipes/Cuisines/Vegetarian Cuisine",
    "/Food & Drink/Cooking & Recipes/Cuisines/Vegetarian Cuisine/Vegan Cuisine",
    "/Food & Drink/Cooking & Recipes/Healthy Eating",
    "/Food & Drink/Food & Grocery Retailers",
    "/Games",
    "/Games/Billiards",
    "/Games/Card Games",
    "/Games/Computer & Video Games",
    "/Games/Computer & Video Games/Action & Platform Games",
    "/Games/Computer & Video Games/Adventure Games",
    "/Games/Computer & Video Games/Casual Games",
    "/Games/Computer & Video Games/Competitive Video Gaming",
    "/Games/Computer & Video Games/Massively Multiplayer Games",
    "/Games/Computer & Video Games/Music & Dance Games",
    "/Games/Computer & Video Games/Simulation Games",
    "/Games/Computer & Video Games/Sports Games",
    "/Games/Computer & Video Games/Strategy Games",
    "/Games/Drawing & Coloring",
    "/Games/Roleplaying Games",
    "/Games/Table Tennis",
    "/Hobbies & Leisure",
    "/Hobbies & Leisure/Anniversaries",
    "/Hobbies & Leisure/Birthdays & Name Days",
    "/Hobbies & Leisure/Diving & Underwater Activities",
    "/Hobbies & Leisure/Fiber & Textile Arts",
    "/Hobbies & Leisure/Outdoors",
    "/Hobbies & Leisure/Outdoors/Fishing",
    "/Hobbies & Leisure/Outdoors/Hunting & Shooting",
    "/Hobbies & Leisure/Paintball",
    "/Hobbies & Leisure/Radio Control & Modeling",
    "/Hobbies & Leisure/Weddings",
    "/Home & Garden",
    "/Home & Garden/Gardening",
    "/Home & Garden/Home & Interior Decor",
    "/Home & Garden/Home Appliances",
    "/Home & Garden/Home Improvement",
    "/Home & Garden/Home Safety & Security",
    "/Home & Garden/Household Supplies",
    "/Home & Garden/Landscape Design",
    "/Internet & Telecom",
    "/Internet & Telecom/Email",
    "/Internet & Telecom/ISPs",
    "/Internet & Telecom/Phone Service Providers",
    "/Internet & Telecom/Search Engines",
    "/Internet & Telecom/Smart Phones",
    "/Internet & Telecom/Teleconferencing",
    "/Internet & Telecom/Text & Instant Messaging",
    "/Internet & Telecom/Web Apps & Online Tools",
    "/Internet & Telecom/Web Design & Development",
    "/Internet & Telecom/Web Hosting",
    "/Jobs & Education",
    "/Jobs & Education/Education",
    "/Jobs & Education/Education/Academic Conferences & Publications",
    "/Jobs & Education/Education/Colleges & Universities",
    "/Jobs & Education/Education/Distance Learning",
    "/Jobs & Education/Education/Early Childhood Education",
    "/Jobs & Education/Education/Early Childhood Education/Preschool",
    "/Jobs & Education/Education/Homeschooling",
    "/Jobs & Education/Education/Standardized & Admissions Tests",
    "/Jobs & Education/Education/Vocational & Continuing Education",
    "/Jobs & Education/Jobs",
    "/Jobs & Education/Jobs/Career Resources & Planning",
    "/Jobs & Education/Jobs/Job Listings",
    "/Law & Government",
    "/Law & Government/Crime & Justice",
    "/Law & Government/Legal",
    "/Law & Government/Legal/Legal Services",
    "/News",
    "/News/Economy News",
    "/News/Local News",
    "/News/Mergers & Acquisitions",
    "/News/Politics",
    "/News/Weather",
    "/News/World News",
    "/Online Communities",
    "/Online Communities/Dating & Personals",
    "/Online Communities/Forum & Chat Providers",
    "/Online Communities/Social Networks",
    "/People & Society",
    "/People & Society/Family & Relationships",
    "/People & Society/Family & Relationships/Ancestry & Genealogy",
    "/People & Society/Family & Relationships/Marriage",
    "/People & Society/Family & Relationships/Parenting",
    "/People & Society/Family & Relationships/Parenting/Adoption",
    "/People & Society/Family & Relationships/Parenting/Babies & Toddlers",
    "/People & Society/Family & Relationships/Parenting/Child Internet Safety",
    "/People & Society/Science Fiction & Fantasy",
    "/Pets & Animals",
    "/Pets & Animals/Pet Food & Pet Care Supplies",
    "/Pets & Animals/Pets",
    "/Pets & Animals/Pets/Birds",
    "/Pets & Animals/Pets/Cats",
    "/Pets & Animals/Pets/Dogs",
    "/Pets & Animals/Pets/Fish & Aquaria",
    "/Pets & Animals/Pets/Reptiles & Amphibians",
    "/Pets & Animals/Veterinarians",
    "/Real Estate",
    "/Real Estate/Lots & Land",
    "/Real Estate/Timeshares & Vacation Properties",
    "/Reference",
    "/Reference/Educational Resources",
    "/Reference/Foreign Language Study",
    "/Reference/How-To, DIY & Expert Content",
    "/Science",
    "/Science/Augmented & Virtual Reality",
    "/Science/Biological Sciences",
    "/Science/Biological Sciences/Genetics",
    "/Science/Chemistry",
    "/Science/Ecology & Environment",
    "/Science/Geology",
    "/Science/Machine Learning & Artificial Intelligence",
    "/Science/Physics",
    "/Science/Robotics",
    "/Shopping",
    "/Shopping/Antiques & Collectibles",
    "/Shopping/Children's Clothing",
    "/Shopping/Consumer Resources",
    "/Shopping/Consumer Resources/Coupons & Discount Offers",
    "/Shopping/Costumes",
    "/Shopping/Flowers",
    "/Shopping/Men's Clothing",
    "/Shopping/Party & Holiday Supplies",
    "/Shopping/Women's Clothing",
    "/Sports",
    "/Sports/American Football",
    "/Sports/Australian Football",
    "/Sports/Auto Racing",
    "/Sports/Baseball",
    "/Sports/Basketball",
    "/Sports/Bowling",
    "/Sports/Boxing",
    "/Sports/Cheerleading",
    "/Sports/College Sports",
    "/Sports/Cricket",
    "/Sports/Cycling",
    "/Sports/Equestrian",
    "/Sports/Extreme Sports",
    "/Sports/Extreme Sports/Climbing & Mountaineering",
    "/Sports/Fantasy Sports",
    "/Sports/Golf",
    "/Sports/Gymnastics",
    "/Sports/Hockey",
    "/Sports/Ice Skating",
    "/Sports/Martial Arts",
    "/Sports/Motorcycle Racing",
    "/Sports/Olympics",
    "/Sports/Rugby",
    "/Sports/Running & Walking",
    "/Sports/Skiing & Snowboarding",
    "/Sports/Soccer",
    "/Sports/Surfing",
    "/Sports/Swimming",
    "/Sports/Tennis",
    "/Sports/Track & Field",
    "/Sports/Volleyball",
    "/Sports/Wrestling",
    "/Travel & Transportation",
    "/Travel & Transportation/Adventure Travel",
    "/Travel & Transportation/Air Travel",
    "/Travel & Transportation/Business Travel",
    "/Travel & Transportation/Car Rentals",
    "/Travel & Transportation/Cruises & Charters",
    "/Travel & Transportation/Family Travel",
    "/Travel & Transportation/Honeymoons & Romantic Getaways",
    "/Travel & Transportation/Hotels & Accommodations",
    "/Travel & Transportation/Long Distance Bus & Rail",
    "/Travel & Transportation/Low Cost & Last Minute Travel",
    "/Travel & Transportation/Luggage & Travel Accessories",
    "/Travel & Transportation/Tourist Destinations",
    "/Travel & Transportation/Tourist Destinations/Beaches & Islands",
    "/Travel & Transportation/Tourist Destinations/Regional Parks & Gardens",
    "/Travel & Transportation/Tourist Destinations/Theme Parks",
    "/Travel & Transportation/Tourist Destinations/Zoos, Aquariums & Preserves",
    "/Travel & Transportation/Travel Guides & Travelogues")
}